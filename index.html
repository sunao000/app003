<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>自転車ルート比較＋休憩（距離非依存の候補N件→上位3組合せ） v6.4</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
body{margin:0;font-family:system-ui,sans-serif}
#map{height:520px;width:100%}
#controls{display:flex;flex-wrap:wrap;gap:8px;padding:8px;background:#f7f7f7;position:relative}
#pointList{list-style:none;margin:0;padding:8px}
#pointList li{display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:space-between;padding:4px 8px;border:1px solid #ccc;background:#fafafa;margin-bottom:4px;cursor:move}
button.del{background:#d9534f;color:#fff;border:none;border-radius:4px;padding:0 6px;font-size:12px}
.section{padding:8px;background:#fff;border-top:1px solid #eee}
.small{font-size:.88em;color:#555}
.badge{display:inline-block;padding:1px 6px;border-radius:999px;background:#eef;border:1px solid #cdd;font-size:.8em}
.klist{display:grid;gap:6px}
.kcard{border:1px solid #ddd;border-radius:8px;padding:8px}
.kcard h4{margin:0 0 6px 0;font-size:1rem}
.kcard .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
label.chk{display:inline-flex;align-items:center;gap:6px;margin-right:10px}
#searchBoxWrap{position:relative}
#srch{width:280px}
#searchResults{position:absolute;left:0;top:36px;width:100%;max-height:260px;overflow:auto;list-style:none;margin:4px 0 0;padding:0;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 4px 16px rgba(0,0,0,.08);z-index:1000}
#searchResults li{padding:8px 10px;cursor:pointer;border-bottom:1px solid #eee}
#searchResults li:last-child{border-bottom:none}
#searchResults li:hover{background:#f0f4ff}
.unit{opacity:.7;margin-left:4px}
.input-compact input{width:90px}
.chips{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
hr.sep{border:none;border-top:1px solid #eee;margin:8px 0}
.tag{display:inline-block;font-size:.77em;padding:2px 6px;border-radius:999px;background:#f6f6ff;border:1px solid #dde}
</style>
</head>
<body>

<div id="controls">
  <div id="searchBoxWrap">
    <input id="srch" placeholder="地名・住所で検索">
    <ul id="searchResults" hidden></ul>
  </div>
  <button id="btnAdd">追加</button>
  <button id="locBtn">現在地</button>
  <button id="drawBtn">ルート表示</button>
  <label class="chk"><input type="checkbox" id="showShortest" checked>最短</label>
  <label class="chk"><input type="checkbox" id="showFastest" checked>最速</label>
</div>

<ul id="pointList"></ul>
<div id="map"></div>

<div class="section">
  <details open>
    <summary>休憩候補（距離非依存で N 件）→ 組合せの上位3を提案・適用</summary>

    <div class="chips" style="margin-top:6px">
      <span class="small">候補カテゴリ：</span>
      <label class="chk"><input type="checkbox" id="catConv" checked> コンビニ</label>
      <label class="chk"><input type="checkbox" id="catSuper" checked> スーパー</label>
      <label class="chk"><input type="checkbox" id="catDrug"  checked> ドラッグストア</label>
      <label class="chk">半径 <input id="poiRadius" type="number" value="300" step="50" min="50" style="width:80px"> m</label>
      <label class="chk">候補数 <input id="candCount" type="number" value="3" step="1" min="1" style="width:80px"></label>
    </div>

    <hr class="sep">

    <div class="small" style="margin:6px 0 10px">
      評価は <b>距離 / 時間 / エネルギー</b> のうち <b>1つ</b>を選び、その <b>平均</b> と <b>分散</b> への近さ（2乗誤差）で最適化します。
    </div>
    <div class="small input-compact" style="display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end;margin-bottom:8px">
      <label>評価対象
        <select id="evalMetric">
          <option value="distance" selected>距離</option>
          <option value="time">時間</option>
          <option value="energy">エネルギー</option>
        </select>
      </label>
      <label>目標 平均 <input id="targetMean" type="number" value="20" step="0.1"><span id="unitMean" class="unit">km</span></label>
      <label>目標 分散 <input id="targetVar" type="number" value="9" step="0.1"><span id="unitVar" class="unit">km²</span></label>
      <label>ビーム幅 <input id="beamWidth" type="number" value="30" step="1" min="3"></label>
    </div>

    <div style="margin:8px 0;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <button id="btnCollectCands">休憩候補を収集</button>
      <button id="btnSolveBoth" disabled>最短/最速の候補を計算</button>
      <span id="optStatus" class="small"></span>
    </div>

    <div class="klist">
      <div class="kcard" id="cardShortest">
        <h4>最短モードの上位3組合せ</h4>
        <div id="listShortest" class="klist"></div>
      </div>
      <div class="kcard" id="cardFastest">
        <h4>最速モードの上位3組合せ</h4>
        <div id="listFastest" class="klist"></div>
      </div>
    </div>
  </details>
</div>

<script>
/* ====== 設定 ====== */
const ORS_KEY='5b3ce3597851110001cf62481af47799d9c344bf86dd4b340f9f9ff9'; // ←★あなたの ORS API キー
const ORS_ROOT='https://api.openrouteservice.org';
const SHUFFLE_CANDS = true; // 距離非依存を強調：取得後に軽くシャッフル（false なら取得順のまま）

/* ====== ヘルパ ====== */
function $(id){return document.getElementById(id);}
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
function icon(c){return new L.Icon({iconUrl:'https://maps.gstatic.com/mapfiles/ms2/micons/'+c+'-dot.png',iconSize:[32,32],iconAnchor:[16,32]});}
const ICONS={start:icon('green'),via:icon('blue'),goal:icon('red')};
function mean(a){return a.length?a.reduce((x,y)=>x+y,0)/a.length:0;}
function variance(a){if(!a.length) return 0; const m=mean(a); return a.reduce((s,x)=>s+(x-m)*(x-m),0)/a.length;}
function debounce(fn,ms){let t;return (...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args),ms);}}
function shuffleInPlace(arr){for(let i=arr.length-1;i>0;i--){const j=(Math.random()*(i+1))|0;[arr[i],arr[j]]=[arr[j],arr[i]];}}

/* ====== 状態 ====== */
let map, markerLayer, routeLayers={};
let pts=[]; // {name,lat,lon,type:start/via/goal, isRest?, restCandidates?[]}
let lastDirTs=0;
const pairCache=new Map();
let _lastSearchResults=[];

/* ====== 初期化 ====== */
window.addEventListener('DOMContentLoaded',()=>{
  map=L.map('map').setView([34.07,134.55],11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'©OpenStreetMap'}).addTo(map);
  map.createPane('routeShortest').style.zIndex=700;
  map.createPane('routeFastest').style.zIndex=710;

  // 検索候補
  $('srch').addEventListener('input', debounce(onSearchInput, 280));
  $('srch').addEventListener('keydown', onSearchKeyDown);
  document.addEventListener('click', (e)=>{ if(!$('searchBoxWrap').contains(e.target)) hideSearchResults(); });

  $('btnAdd').onclick=addSelectedOrFirst;
  $('locBtn').onclick=addCurrent;
  $('drawBtn').onclick=drawRoutes;

  $('btnCollectCands').onclick=async()=>{
    $('optStatus').textContent='休憩トリガ生成＆候補収集中...';
    await ensureRests();               // 休憩トリガ（kJ固定）を自動生成
    await buildRestCandidatesForAll(); // 各休憩の候補（距離非依存でN件）
    $('optStatus').textContent='候補OK。計算できます。';
    $('btnSolveBoth').disabled=false;
  };
  $('btnSolveBoth').onclick=solveBothModes;

  $('evalMetric').addEventListener('change', syncMetricUnits);
  syncMetricUnits();

  initList();

  // デモ用：2点
  pts=[{name:'出発',lat:34.07,lon:134.55,type:'start'},{name:'到着',lat:34.15,lon:134.60,type:'goal'}];
  drawList();
});

/* ====== 検索候補 UI ====== */
function renderSearchResults(items){
  const ul=$('searchResults');
  ul.innerHTML='';
  if(!items.length){ ul.hidden=true; return; }
  items.forEach((o,idx)=>{
    const li=document.createElement('li');
    li.textContent=o.display_name;
    li.dataset.idx=idx;
    li.onclick=()=>{ selectSearchItem(idx); };
    ul.appendChild(li);
  });
  ul.hidden=false;
}
function hideSearchResults(){ $('searchResults').hidden=true; }
async function onSearchInput(){
  const q=$('srch').value.trim();
  if(!q){ hideSearchResults(); _lastSearchResults=[]; return; }
  const url='https://nominatim.openstreetmap.org/search?format=json&limit=10&q='+encodeURIComponent(q);
  try{
    const arr=await (await fetch(url)).json();
    _lastSearchResults=arr||[];
    renderSearchResults(_lastSearchResults);
  }catch(e){
    _lastSearchResults=[];
    hideSearchResults();
  }
}
function onSearchKeyDown(e){
  if(e.key==='Enter'){
    e.preventDefault();
    addSelectedOrFirst();
  }else if(e.key==='Escape'){
    hideSearchResults();
  }
}
function selectSearchItem(idx){
  const o=_lastSearchResults[idx];
  if(!o) return;
  addPoint({name:o.display_name,lat:+o.lat,lon:+o.lon});
  $('srch').value='';
  hideSearchResults();
}
function addSelectedOrFirst(){
  if(!_lastSearchResults.length){ return; }
  selectSearchItem(0);
}

/* ====== UI: 地点操作 ====== */
function addCurrent(){navigator.geolocation.getCurrentPosition(p=>addPoint({name:'現在地',lat:p.coords.latitude,lon:p.coords.longitude}),()=>alert('現在地取得失敗'));}
function addPoint(p){p.type=pts.length?'via':'start'; pts.forEach(d=>{if(d.type==='goal') d.type='via';}); pts.push(p); if(pts.length>1) pts[pts.length-1].type='goal'; drawList();}
function fixType(){ if(pts[0]) pts[0].type='start'; if(pts.length>1) pts[pts.length-1].type='goal'; }
function initList(){ new Sortable($('pointList'),{animation:150,handle:'span',onEnd:()=>{pts=Array.from($('pointList').children).map(li=>pts[li._idx]); fixType(); drawList();}}); }
function drawList(){
  const ul=$('pointList'); ul.innerHTML='';
  pts.forEach((p,i)=>{
    const li=document.createElement('li'); li._idx=i;
    const t=document.createElement('span'); t.textContent=p.name+(p.isRest?'（休憩）':''); li.appendChild(t);
    const del=document.createElement('button'); del.className='del'; del.textContent='×';
    del.onclick=(e)=>{e.stopPropagation(); pts.splice(i,1); fixType(); drawList();}; li.appendChild(del);

    if(p.isRest && Array.isArray(p.restCandidates) && p.restCandidates.length){
      const det=document.createElement('details'); const sum=document.createElement('summary'); sum.textContent=`候補（${p.restCandidates.length}件）`; det.appendChild(sum);
      const ul2=document.createElement('ul'); ul2.style.margin='6px 0 0 16px';
      p.restCandidates.forEach((c,idx)=>{ 
        const li2=document.createElement('li'); 
        li2.innerHTML=`#${idx+1} ${c.name||'POI'} <span class="tag">${labelForCat(c.cat)}</span>`;
        ul2.appendChild(li2);
      });
      det.appendChild(ul2); li.appendChild(det);
    }
    ul.appendChild(li);
  });
}

/* ====== ORS ====== */
async function post(url,body){
  const r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json','Authorization':ORS_KEY},body:JSON.stringify(body)});
  if(!r.ok) throw new Error(r.status);
  return r.json();
}
async function dir(body,profile){
  const wait=1100-(Date.now()-lastDirTs);
  if(wait>0) await sleep(wait);
  const d=await post(ORS_ROOT+'/v2/directions/'+profile+'/geojson',body);
  lastDirTs=Date.now();
  return d;
}

/* ====== エネルギー（簡易） ====== */
function energyStepKJ(d,dz,m,flat){return flat*(d/1000)+Math.max(dz,0)*m*9.80665/1000;}

/* ====== 休憩トリガ（kJしきい値シンプル版） ====== */
function buildCumDistArray(coords){
  const cd=[0];
  for(let i=1;i<coords.length;i++){
    const [lon,lat]=coords[i]; const [plon,plat]=coords[i-1];
    cd[i]=cd[i-1]+L.latLng(lat,lon).distanceTo([plat,plon]);
  }
  return cd;
}
async function makeRestSimple(previewFeature,mass,flat,thrKJ){
  const coords=previewFeature.geometry.coordinates;
  const segs=(previewFeature.properties.segments||[]);
  const hasEle=(coords[0].length>=3);
  const cum=buildCumDistArray(coords);
  let acc=0; const out=[];
  for(const s of segs){
    const steps=s.steps||[];
    for(const st of steps){
      const [i0,i1]=st.way_points||[0,0];
      const d=st.distance||0;
      const dz=hasEle?((coords[i1][2]||0)-(coords[i0][2]||0)):0;
      const dE=energyStepKJ(d,dz,mass,flat);
      acc+=dE;
      if(acc>=thrKJ){
        out.push({name:'休憩',lat:coords[i1][1],lon:coords[i1][0],routeD:cum[i1],type:'via',isRest:true});
        acc=0;
      }
    }
  }
  return out;
}
async function ensureRests(){
  // 既存休憩を一旦除去→プレビューから再生成
  pts=pts.filter(p=>!p.isRest); fixType(); drawList(); if(pts.length<2) return;
  const profile='cycling-road', mass=75, flat=18, thrKJ=500;
  const coords=pts.map(p=>[p.lon,p.lat]);
  const preview=await dir({coordinates:coords,elevation:true,preference:'fastest',extra_info:['steepness']},profile);
  const feat=preview.features[0];
  const rests=await makeRestSimple(feat,mass,flat,thrKJ);
  if(rests.length){
    const insertPos=Math.max(pts.length-1,1);
    pts.splice(insertPos,0,...rests);
    fixType(); drawList();
  }
}

/* ====== POIカテゴリ（距離非依存で N 件） ====== */
function labelForCat(cat){ return cat==='conv'?'コンビニ':cat==='super'?'スーパー':'ドラッグストア'; }
function selectedCategories(){
  const arr=[];
  if($('catConv').checked)  arr.push('conv');
  if($('catSuper').checked) arr.push('super');
  if($('catDrug').checked)  arr.push('drug');
  return arr;
}
function blockFor(cat, lat, lon, radiusM){
  const A = `around:${radiusM},${lat},${lon}`;
  if(cat==='conv') return `node["amenity"="convenience"](${A});`;
  if(cat==='super')return `node["shop"="supermarket"](${A});`;
  return `node["shop"="chemist"](${A});node["shop"="pharmacy"](${A});`; // drug
}
async function fetchPoisAroundCats(lat,lon,radiusM,cats,limit=60){
  if(!cats.length) return [];
  const blocks = cats.map(c => blockFor(c,lat,lon,radiusM)).join('\n');
  const q = `[out:json][timeout:25];(${blocks});out center ${limit};`;
  const r=await fetch('https://overpass-api.de/api/interpreter',{
    method:'POST',
    body:`data=${encodeURIComponent(q)}`,
    headers:{'Content-Type':'application/x-www-form-urlencoded'}
  });
  const data=await r.json();
  const els=(data.elements||[]);
  return els.map(e=>{
    const lat2=e.lat||e.center?.lat, lon2=e.lon||e.center?.lon;
    const tags=e.tags||{};
    const name=tags['name:ja']||tags.name||tags.brand||'POI';
    let cat='conv';
    if(tags.shop==='supermarket') cat='super';
    else if(tags.shop==='chemist' || tags.shop==='pharmacy') cat='drug';
    else if(tags.amenity==='convenience') cat='conv';
    return {lat:lat2, lon:lon2, name, cat};
  });
}
async function buildRestCandidatesForAll(){
  const rests=pts.filter(p=>p.isRest);
  const cats=selectedCategories();
  const radius=Math.max(10, +$('poiRadius').value || 300);
  const N = Math.max(1, +$('candCount').value || 3);

  for(let i=0;i<rests.length;i++){
    const p=rests[i];
    try{
      if(i>0) await sleep(250);
      let pois=await fetchPoisAroundCats(p.lat,p.lon,radius,cats,Math.max(60,N*3));
      // 距離非依存: 並べ替えない（オプションでシャッフル）
      if(SHUFFLE_CANDS) shuffleInPlace(pois);
      p.restCandidates = pois.slice(0, N);
    }catch(e){
      console.warn('候補収集失敗',e);
      p.restCandidates=[];
    }
  }
  drawList();
}

/* ====== 区間メトリクス（preference 切替対応） ====== */
async function getPairMetrics(a,b,preference,profile='cycling-road',mass=75,flat=18){
  const key=`${preference}|${a.lon.toFixed(6)},${a.lat.toFixed(6)}|${b.lon.toFixed(6)},${b.lat.toFixed(6)}`;
  if(pairCache.has(key)) return pairCache.get(key);
  const body={coordinates:[[a.lon,a.lat],[b.lon,b.lat]],elevation:true,preference};
  const res=await dir(body,profile);
  const f=res.features[0];
  const km=f.properties.summary.distance/1000;
  const sec=f.properties.summary.duration;
  let kJ=0; const coords=f.geometry.coordinates;
  for(let i=1;i<coords.length;i++){
    const d=L.latLng(coords[i][1],coords[i][0]).distanceTo([coords[i-1][1],coords[i-1][0]]);
    const dz=(coords[i][2]||0)-(coords[i-1][2]||0);
    kJ+=energyStepKJ(d,dz,mass,flat);
  }
  const val={km,min:sec/60,kJ};
  pairCache.set(key,val);
  return val;
}

/* ====== 評価（距離／時間／エネルギーの平均・分散） ====== */
function getEvalConfig(){
  const metric=$('evalMetric').value;      // 'distance' | 'time' | 'energy'
  const meanT=+$('targetMean').value || 0;
  const varT=+$('targetVar').value  || 0;
  const beam=Math.max(3, +$('beamWidth').value || 30);
  return {metric, meanT, varT, beam};
}
function syncMetricUnits(){
  const m=$('evalMetric').value;
  const uM=(m==='distance'?'km': m==='time'?'分':'kJ');
  const uV=(m==='distance'?'km²': m==='time'?'分²':'kJ²');
  $('unitMean').textContent=uM;
  $('unitVar').textContent=uV;
  if(m==='distance'){ $('targetMean').value=20; $('targetVar').value=9; }
  if(m==='time'){ $('targetMean').value=60; $('targetVar').value=400; }
  if(m==='energy'){ $('targetMean').value=500; $('targetVar').value=100; }
}
function evalCostFromSeries(series, cfg){
  let xs;
  if(cfg.metric==='distance') xs = series.map(s=>s.km);
  else if(cfg.metric==='time') xs = series.map(s=>s.min);
  else xs = series.map(s=>s.kJ);
  const mm = mean(xs), vv = variance(xs);
  return (mm-cfg.meanT)**2 + (vv-cfg.varT)**2;
}

/* ====== 組合せ探索（ビーム）＆上位3件抽出 ====== */
function buildGroupsFromPts(){
  const start=pts.find(p=>p.type==='start');
  const goal=pts.find(p=>p.type==='goal');
  const restGroups=pts.filter(p=>p.isRest).map(p=>{
    if(Array.isArray(p.restCandidates)&&p.restCandidates.length){
      return p.restCandidates.map(c=>({name:c.name||'候補',lat:c.lat,lon:c.lon}));
    }
    return [{name:p.name,lat:p.lat,lon:p.lon}];
  });
  return [[{name:start.name,lat:start.lat,lon:start.lon}], ...restGroups, [{name:goal.name,lat:goal.lat,lon:goal.lon}]];
}

async function topKCombinations(preference, K=3, cfg={metric:'distance', meanT:20, varT:9, beam:30}){
  const groups=buildGroupsFromPts();
  if(groups.length<2) return [];

  let beam=[{node:groups[0][0], path:[groups[0][0]], legs:[], cost:0}];

  for(let gi=1; gi<groups.length; gi++){
    const next=groups[gi]; const nb=[];
    for(const st of beam){
      for(const cand of next){
        const met=await getPairMetrics(st.node,cand,preference);
        const legs=st.legs.concat([met]);
        const cost=evalCostFromSeries(legs, cfg);
        nb.push({node:cand, path:st.path.concat([cand]), legs, cost});
      }
    }
    nb.sort((a,b)=>a.cost-b.cost);
    beam=nb.slice(0,cfg.beam);
  }
  return [...beam].sort((a,b)=>a.cost-b.cost).slice(0,K);
}

function renderTopK(listEl, items){
  listEl.innerHTML='';
  if(!items.length){ listEl.innerHTML='<div class="small">候補がありません</div>'; return; }
  items.forEach((it,idx)=>{
    const div=document.createElement('div'); div.className='kcard';
    const heads=it.path.slice(1,it.path.length-1).map(p=>p.name||'休憩').join(' / ');
    div.innerHTML=`<div class="row"><strong>#${idx+1}</strong><span>cost=${it.cost.toFixed(3)}</span></div>
                   <div class="small">休憩選択: ${heads||'（休憩なし）'}</div>
                   <div style="margin-top:6px"><button>この組合せを適用</button></div>`;
    div.querySelector('button').onclick=()=>{ applyPathToRests(it.path); drawRoutes(); };
    listEl.appendChild(div);
  });
}
function applyPathToRests(path){
  const chosenRests=path.slice(1,path.length-1);
  let i=0;
  for(const p of pts){
    if(p.isRest && chosenRests[i]){
      p.lat=chosenRests[i].lat;
      p.lon=chosenRests[i].lon;
      i++;
    }
  }
  drawList();
}

/* ====== ルート描画（最短/最速のみ） ====== */
async function drawRoutes(){
  if(pts.length<2) return alert('2地点以上登録してください');
  Object.values(routeLayers).forEach(l=>{ if(l) map.removeLayer(l); }); routeLayers={};
  if(markerLayer) map.removeLayer(markerLayer);

  // マーカー
  markerLayer=L.layerGroup().addTo(map);
  pts.forEach(p=>{
    const ic=p.type==='start'?ICONS.start:(p.type==='goal'?ICONS.goal:ICONS.via);
    markerLayer.addLayer(L.marker([p.lat,p.lon],{icon:ic}).bindTooltip(p.name));
  });

  const coords=pts.map(p=>[p.lon,p.lat]);
  const base={coordinates:coords,elevation:true};

  try{
    if($('showShortest').checked){
      const r1=await dir({...base,preference:'shortest'},'cycling-road');
      routeLayers.short=L.geoJSON(r1.features[0],{pane:'routeShortest',style:{color:'#ff0000',weight:5}}).addTo(map);
    }
    if($('showFastest').checked){
      const r2=await dir({...base,preference:'fastest'},'cycling-road');
      routeLayers.fast=L.geoJSON(r2.features[0],{pane:'routeFastest',style:{color:'#0066ff',weight:5,dashArray:'4 4'}}).addTo(map);
    }
    // 表示範囲フィット
    let b=null; Object.values(routeLayers).forEach(l=>{ if(l){ b=b? b.extend(l.getBounds()) : l.getBounds(); }});
    if(b) map.fitBounds(b.pad(0.1));
  }catch(e){
    console.error(e);
    alert('ルート取得失敗: '+e.message);
  }
}

/* ====== 両モードで上位3を計算 → 表示 ====== */
async function solveBothModes(){
  $('optStatus').textContent='計算中...';
  const cfg=getEvalConfig();
  const [shortTop, fastTop] = await Promise.all([
    topKCombinations('shortest',3,cfg),
    topKCombinations('fastest',3,cfg)
  ]);
  renderTopK($('listShortest'), shortTop);
  renderTopK($('listFastest'), fastTop);
  $('optStatus').textContent='完了。上から良い順です。任意の「適用」を押してください。';
}
</script>
</body>
</html>
